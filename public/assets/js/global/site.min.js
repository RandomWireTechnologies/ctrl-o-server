(function (window, document, $) {
    'use strict';
    var tour = new Tour({
        name: 'test',
        debug: false,
        orphan: true,
        smartPlacement: true,
        animation: true,
        container: "body",
        backdrop: true,
        backdropContainer: 'body',
        backdropPadding: false,
        steps: [
            {
                element: "#search-icon",
                title: "Search",
                placement: "left",
                content: "Click this button you can search the admin template.",
                template: "<div class='popover tour'><div class='arrow'></div><h3 class='popover-title'></h3><div class='popover-content'></div><div class='popover-navigation'><button class='btn btn-info pull-left' data-role='prev'>« Prev</button><button class='btn btn-info' data-role='end'>Close</button><button class='btn btn-info margin-left-5' data-role='next'>Next »</button></div></div>",
            }, {
                element: "#toggleFullscreen",
                title: "Full Screen",
                placement: "left",
                content: "Click this button you can view the admin template in full screen.",
                template: "<div class='popover tour'><div class='arrow'></div><h3 class='popover-title'></h3><div class='popover-content'></div><div class='popover-navigation'><button class='btn btn-info pull-left' data-role='prev'>« Prev</button><button class='btn btn-info' data-role='end'>Close</button><button class='btn btn-info margin-left-5' data-role='next'>Next »</button></div></div>",
            },
            {
                element: "#chatbox",
                title: "Chatbox",
                placement: "left",
                content: "This is a sidebar dialog box for user chat list.",
                template: "<div class='popover tour'><div class='arrow'></div><h3 class='popover-title'></h3><div class='popover-content'></div><div class='popover-navigation'><button class='btn btn-info pull-left' data-role='prev'>« Prev</button><button class='btn btn-info' data-role='end'>Close</button><button class='btn btn-info margin-left-5' data-role='next'>Next »</button></div></div>",
            },
            {
                element: ".flag-avtar",
                title: "Country Language",
                placement: "left",
                content: "You can use different country languages.",
                template: "<div class='popover tour'><div class='arrow'></div><h3 class='popover-title'></h3><div class='popover-content'></div><div class='popover-navigation'><button class='btn btn-info' data-role='prev'>« Prev</button><button class='btn btn-info' data-role='end'>End tour</button></div></div>",
            }
        ]
    });

    // Start the tour
    tour.start();

    jQuery('#demo').on('click', function () {
        tour.restart(true);
    });
    var $body = $(document.body);

    // configs setup
    // =============

    window.Site = {
        run: function (next) {


            // Tooltip setup
            // =============
            $(document).tooltip({
                selector: '[data-tooltip=true]',
                container: 'body'
            });

            $('[data-toggle="tooltip"]').tooltip();
            $('[data-toggle="popover"]').popover();


            // Dropdown menu setup
            // ===================
            $body.on('click', '.dropdown-menu-media', function (e) {
                e.stopPropagation();
            });


            // Mega navbar setup
            // =================
            $(document).on('click', '.navbar-mega .dropdown-menu', function (e) {
                e.stopPropagation();
            });

            $(document).on('show.bs.dropdown', function (e) {
                var $target = $(e.target);
                var $trigger = e.relatedTarget ? $(e.relatedTarget) : $target.children('[data-toggle="dropdown"]');

                var animation = $trigger.data('animation');
                if (animation) {
                    var $menu = $target.children('.dropdown-menu');
                    $menu.addClass('animation-' + animation);

                    $menu.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function () {
                        $menu.removeClass('animation-' + animation);
                    });
                }
            });


            this.startTour();
        },
        startTour: function (flag) {
            if (typeof this.tour === 'undefined') {
                if (typeof introJs === 'undefined') {
                    return;
                }

                var tourOptions = $.configs.get('tour'),
                        self = this;
                flag = $('body').css('overflow');
                this.tour = introJs();

                this.tour.onbeforechange(function () {
                    $('body').css('overflow', 'hidden');
                });

                this.tour.oncomplete(function () {
                    $('body').css('overflow', flag);
                });

                this.tour.onexit(function () {
                    $('body').css('overflow', flag);
                });

                this.tour.setOptions(tourOptions);
                $('.site-tour-trigger').on('click', function () {
                    self.tour.start();
                });
            }
        }
    };
    // Page Actions Waves
    // =========================
    if (typeof Waves !== 'undefined') {
        Waves.init();
        Waves.attach('.site-menu-item > a', ['waves-classic']);
        Waves.attach(".site-navbar .navbar-toolbar [data-toggle='menubar']", ["waves-light", "waves-round"]);
        Waves.attach(".page-header-actions .btn:not(.btn-inverse)", ["waves-light", "waves-round"]);
        Waves.attach(".page-header-actions .btn-inverse", ["waves-classic", "waves-round"]);
        Waves.attach('.page > div:not(.page-header) .btn:not(.ladda-button):not(.btn-round):not(.btn-pure):not(.btn-floating):not(.btn-flat)', ['waves-light']);
        Waves.attach('.page > div:not(.page-header) .btn-pure:not(.ladda-button):not(.btn-round):not(.btn-floating):not(.btn-flat):not(.icon)', ['waves-classic']);
    }
    
    window.Site.run();

    jQuery(".input-search-close").on('click', function () {
        jQuery(".input-search input").val("");
    });

    var viewportWidth = $(window).width();
    jQuery(".mobile-megamenu").on('click', function () {

    });


    jQuery("#search-icon a").on('click', function () {
        jQuery("#site-navbar-search").toggleClass("search-toggle");
    });

    jQuery(".input-search-close").on('click', function () {
        jQuery("#site-navbar-search").removeClass("search-toggle");
    });

    jQuery('body').mouseup(function () {
        jQuery('#site-navbar-search').removeClass('search-toggle');
    });

    jQuery('#site-navbar-search').mouseup(function () {
        return false;
    });
    
//    jQuery(".datepicker").datepicker({autoclose: !0});

})(window, document, jQuery);

$(document).ready(checkSize);
$(window).resize(checkSize);
$(document).delegate(".mega-menu-content .mobile-drop", "click", function () {
    if ($(window).width() < 992) {
        jQuery(this).toggleClass("menushow");
    }else{
        jQuery(".dropdown-mega").removeClass("open");
    }
});


//Function to the css rule
function checkSize() {
    if ($(window).width() < 992) {
        jQuery(".main-header .dropdown-mega").removeClass("is-hovermenu");
        jQuery(".mega-menu-content h5").addClass("mobile-drop");
    } else {
        jQuery(".main-header .dropdown-mega").addClass("is-hovermenu");
        jQuery(".mega-menu-content h5").removeClass("mobile-drop menushow");
        jQuery(".main-header .dropdown-mega").removeClass("open");
    }
}